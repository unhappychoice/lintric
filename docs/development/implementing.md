# Implementing a New Language Feature

This guide outlines the steps to implement dependency collection for a specific language feature within the Lintric project.

## Workflow

1.  **Prepare Test Fixtures and Test Code:**
    *   Create or modify test fixtures in `core/tests/{lang}/fixtures/` (`.rs`, `.ts`, etc.) that specifically demonstrate the language feature you are implementing. These fixtures should be minimal and focused on the feature in question.
    *   Add or update corresponding test cases in the `core/tests/{lang}/` directory to utilize these new fixtures. Ensure these tests are set up to generate AST and IR snapshots.

2.  **Analyze AST and IR Output:**
    *   Run the debug commands for your fixture to inspect the Abstract Syntax Tree (AST) and Intermediate Representation (IR) generated by Lintric.
        *   For AST: `debug ast {fileName}`
        *   For IR: `debug ir {fileName}`
    *   Carefully examine the output to understand how the language feature is parsed and represented. This step is crucial for identifying the nodes and structures you need to target for dependency collection.

3.  **Implement in `core/src/collector/{lang}/`:**
    *   Navigate to the appropriate collector directory for your language (e.g., `core/src/collector/rust/` or `core/src/collector/typescript/`).
    *   Implement the logic to correctly identify and collect dependencies related to the new language feature. This typically involves:
        *   Traversing the AST.
        *   Identifying relevant nodes (e.g., function calls, variable declarations, imports).
        *   Extracting dependency information (e.g., source, target, type of dependency).
        *   Adding the collected dependencies to the IR.
    *   Adhere to the existing coding style and patterns within the collector.

4.  **Verify Debug AST and IR Output:**
    *   After implementing your changes, re-run the `debug ast {fileName}` and `debug ir {fileName}` commands for your test fixture.
    *   Compare the new output with your expectations.
        *   Does the AST correctly reflect the structure of the language feature?
        *   Does the IR accurately capture the dependencies you intended to collect?
    *   If the output is not correct, return to step 3 and refine your implementation.

5.  **Run Tests and Verify Snapshots:**
    *   Execute the project's test suite.
    *   Verify that the snapshots are updated correctly:
        *   **No Unrelated Changes:** Ensure that only the snapshots related to the language feature you modified have changed. Unintended changes to other snapshots indicate a potential issue with your implementation affecting unrelated parts of the codebase.
        *   **Correct IR/Metrics:** Confirm that the IR and metrics generated for the modified feature's test cases are accurate and reflect the expected dependencies and calculated metrics.

6.  **Pass `cargo fmt` and `cargo clippy`:**
    *   Run `cargo fmt` to format your code according to the project's style guidelines.
    *   Run `cargo clippy` to check for common mistakes and improve code quality.
    *   Address any warnings or errors reported by these tools.

7.  **Implementation Complete:**
    *   Once all the above steps are successfully completed, your implementation for the new language feature dependency is complete.
